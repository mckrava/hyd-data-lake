# Run tests for Liquidity Pools API

name: "Liquidity Pools API testing"

on:
  push:
    branches:
      - "fix/**"
      - "feat/**"
      - "develop"
  pull_request:
    types:
      - "opened"
    branches:
      - "develop"

jobs:
  # Build Indexers
  build:
    name: "Build"
    uses: ./.github/workflows/_called_build_indexers.yml
    with:
      liquidity-pools-build-artifact-name: liquidity-pools-build-files
      dictionary-build-artifact-name: dictionary-build-files
    secrets:
      gh_token: ${{ secrets.GITHUB_TOKEN }}

  run-api-tests:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        workflow:
          - _called_run-liq-pools-indexer-api-no-dict-test.yml
          - _called_run-liq-pools-indexer-api-with-dict-test.yml
          - _called_run-storage-dict-api-test.yml
    steps:
      - name: Call ${{ matrix.workflow }}
        uses: ./.github/workflows/${{ matrix.workflow }}
        with:
          liquidity-pools-build-artifact-name: liquidity-pools-build-files
          dictionary-build-artifact-name: dictionary-build-files

#  trigger-called-workflows:
#    runs-on: ubuntu-latest
#    strategy:
#      matrix:
#        workflow: [ _called_run-liq-pools-indexer-api-no-dict-test.yml ] # Called workflows
#    steps:
#      - name: Trigger ${{ matrix.workflow }}
#        uses: actions/github-script@v7
#        with:
#          github-token: ${{ secrets.GITHUB_TOKEN }}
#          script: |
#            await github.actions.createWorkflowDispatch({
#              owner: context.repo.owner,
#              repo: context.repo.repo,
#              workflow_id: ${{ matrix.workflow }},
#              ref: 'main',
#            });

#  # Run API tests for indexers
#  liq-pools-indexer-no-dict-test:
#    name: " API tests"
#    needs: build
#    if: ${{ needs.build.result=='success' }}
#    uses: ./.github/workflows/_called_run-liq-pools-indexer-api-no-dict-test.yml
#    with:
#      liquidity-pools-build-artifact-name: liquidity-pools-build-files
#      dictionary-build-artifact-name: dictionary-build-files
#
